---
import BaseLayout from "@/layouts/BaseLayout.astro";
import FullScreenRow from "@/components/rows/FullScreenRow.astro";
import Nephex from "@/assets/images/nephex-4.png";
import Blob1 from "@/assets/images/blob-1.svg?raw";
import Blob2 from "@/assets/images/blob-2.svg?raw";
import Blob3 from "@/assets/images/blob-3.svg?raw";
import { Image } from "astro:assets";
import { getEntry } from "astro:content";
import BentoGrid from "@/components/sections/BentoGrid.astro";

const { data } = await getEntry("pages", "homepage");
const {
  bentos,
  subtitle,
  about_text,
  what_we_dos,
  meta_title,
  meta_description,
  scroll_speeds,
} = data;
console.log(what_we_dos);
---

<BaseLayout title={meta_title} description={meta_description}>
  <FullScreenRow
    rowClass="relative bg-[radial-gradient(ellipse_at_left_top,rgba(60,28,49,1)_0%,rgba(0,0,0,1)_50%)]"
    containerClass="max-w-6xl"
    isScrollSection={true}
  >
    <div
      class="max-w-sm sm:max-w-md md:max-w-2xl z-40 mr-auto mt-16"
      data-scroll
      data-scroll-speed={scroll_speeds.hero}
    >
      <h2 class="drop-shadow-custom">
        <div class="text-4xl sm:text-6xl lg:text-8xl uppercase font-bold">
          Calling all
        </div>
        <div
          class="text-7xl sm:text-8xl md:text-9xl lg:text-[10rem] uppercase font-black
        bg-[linear-gradient(97deg,#FF5C00_-13.38%,#F06_57.93%,#FFBA00_79.2%)] inline-block text-transparent bg-clip-text"
        >
          curious minds
        </div>
      </h2>
      <p
        class="max-w-full md:max-w-lg text-lg sm:text-2xl md:text-3xl font-bold"
      >
        {subtitle}
      </p>
    </div>
    <div
      class="absolute right-[-10%] 2xl:right-[-30%] top-[0%] md:bottom-0 z-20 m-auto
      max-w-full w-[500px] h-[500px] md:w-[750px] md:h-[750px] xl:w-[1000px] xl:h-[1000px]"
    >
      <Image
        src={Nephex}
        alt="SUPERMASSIVE logo"
        class="brightness-[0.9]"
        data-scroll-id="nephex"
        data-scroll
        data-scroll-speed={scroll_speeds.furry_boi}
        data-scroll-position="top"
        data-scroll-direction="vertical"
      />
    </div>
    <div
      class="absolute bottom-[-5%] right-[30%] z-10 blur-sm"
      data-scroll
      data-scroll-speed={scroll_speeds.blob_1}
      data-scroll-position="top"
      data-scroll-direction="horizontal"
    >
      <Fragment set:html={Blob1} />
    </div>
    <div
      class="absolute top-[5%] right-[50%] z-0 blur-md"
      data-scroll
      data-scroll-speed={scroll_speeds.blob_2}
      data-scroll-direction="horizontal"
    >
      <Fragment set:html={Blob2} />
    </div>
    <div
      class="absolute bottom-[5%] right-0 z-30"
      data-scroll
      data-scroll-speed={scroll_speeds.blob_3}
      data-scroll-position="top"
      data-scroll-direction="horizontal"
    >
      <Fragment set:html={Blob3} />
    </div>
  </FullScreenRow>
  <section
    class="flex flex-col items-center md:flex-row-reverse md:items-stretch w-full max-w-6xl px-6 md:px-10 mx-auto gap-4 bg-transparent"
    id="about-text-target"
  >
    <div
      class="flex flex-col gap-4 w-full md:w-1/2 max-w-full"
      data-scroll-section
    >
      <article
        class="flex flex-col justify-start items-start rounded-xl
        z-50 gap-4"
        id="about"
        data-scroll
        data-scroll-sticky
        data-scroll-speed={scroll_speeds.about_text}
        data-scroll-repeat
        data-scroll-offset="-25%,25%"
        data-scroll-target="#about-text-target"
      >
        <h2 class="text-4xl xs:text-5xl lg:text-7xl font-bold uppercase mb-4">
          {about_text}
        </h2>
        <button
          class="hidden md:block bg-zinc-300 bg-opacity-0 rounded-2xl border-8 border-white font-heading font-bold text-3xl uppercase py-1 px-12"
          >See more</button
        >
      </article>
    </div>
    <div class="block z-50 w-full md:w-1/2" data-scroll-section>
      <div
        id="bento"
        data-scroll
        data-scroll-speed={scroll_speeds.bento}
        data-scroll-sticky
        data-scroll-repeat
        data-scroll-target="#about-text-target"
      >
        <BentoGrid>
          {
            bentos.map(({ src, alt, class: customClass }) => (
              <Image
                src={src}
                alt={alt}
                class:list={[customClass, `w-full h-full rounded-xl`]}
              />
            ))
          }
        </BentoGrid>
      </div>
    </div>
    <button
      class="block md:hidden bg-zinc-300 bg-opacity-0 rounded-2xl border-8 border-white font-heading font-bold text-3xl uppercase mt-8 py-1 px-12"
      >See more</button
    >
  </section>
  <section
    class="mt-56 mb-36 w-full max-w-6xl px-6 md:px-10 mx-auto gap-4 bg-transparent"
    data-scroll-section
  >
    <h2
      class="text-white text-8xl md:text-9xl font-heading uppercase max-w-sm sm:max-w-full mb-8 font-black"
    >
      What we do
    </h2>
    <div
      class="relative w-full block md:grid md:grid-cols-2 place-items-stretch"
    >
      <aside class="relative hidden md:block mb-12 mr-8">
        {
          what_we_dos.map(
            (
              { title, text, image: { src, alt, class: imageClass } },
              index
            ) => (
              <Image
                src={src}
                alt={alt}
                data-hover-index={index}
                data-hovered={index === 0}
                class:list={[
                  `object-cover h-full rounded-xl hidden md:block absolute transition-opacity duration-500 md:data-[hovered]:opacity-100 opacity-0`,
                  imageClass,
                ]}
              />
            )
          )
        }
      </aside>
      <div class="">
        {
          what_we_dos.map(
            (
              { title, text, image: { src, alt, class: imageClass } },
              index
            ) => (
              <article
                class="mb-12 pointer-events-auto cursor-pointer origin-left group"
                data-hover-target={index}
              >
                <h3
                  class="text-4xl xs:text-5xl sm:text-6xl lg:text-7xl font-heading font-bold inline-block font-body uppercase 
                  bg-[linear-gradient(96deg,#FF401F_16.97%,#F06_70.59%)] text-transparent bg-clip-text
                  md:bg-none md:text-white md:bg-clip-[unset]
                  md:data-[hovered]:bg-[linear-gradient(96deg,#FF401F_16.97%,#F06_70.59%)]
                  md:data-[hovered]:text-transparent 
                  md:data-[hovered]:bg-clip-text"
                  data-hover-index={index}
                  data-hovered={index === 0}
                >
                  {title}
                </h3>
                <p class="text-lg xs:text-xl md:text-2xl mb-8">{text}</p>
                <Image
                  src={src}
                  alt={alt}
                  class:list={[
                    `md:hidden w-full object-cover rounded-xl aspect-square block rounded-xl`,
                    imageClass,
                  ]}
                />
              </article>
            )
          )
        }
      </div>
    </div>
  </section>
</BaseLayout>
<script>
  import scroller from "../lib/scroller";

  scroller.on("scroll", (args: any) => {
    // do something
    const nephex = args.currentElements["nephex"];
    if (typeof nephex === "object") {
      let progress = nephex.progress;
      nephex.el.style.transform = `rotate(${(progress - 0.5) * 0.1}turn)`;
    }
  });
  let breakpoint = 768;
  let bento = document.getElementById("bento");
  let about = document.getElementById("about");

  const responsiveListener = () => {
    let currentWidth = window.innerWidth;
    if (currentWidth > breakpoint) {
      bento?.setAttribute("data-scroll-speed", "10");
      bento?.toggleAttribute("data-scroll-sticky", true);
      bento?.toggleAttribute("data-scroll-sticky", true);
    } else {
      bento?.setAttribute("data-scroll-speed", "1");
      bento?.toggleAttribute("data-scroll-sticky", false);
      about?.toggleAttribute("data-scroll-sticky", false);
    }
    scroller.update();
  };
  // document.addEventListener("DOMContentLoaded", responsiveListener);
  // window.addEventListener("resize", responsiveListener);
</script>
<script>
  const hoverItems = document.querySelectorAll("[data-hover-index]");
  const hoverTargets = document.querySelectorAll("[data-hover-target]");

  let slideIndex = 0;

  const createTimer = () => {
    return setInterval(() => {
      if (slideIndex >= hoverTargets.length) {
        slideIndex = 0;
      }
      toggleHoverIndex(`${slideIndex}`);
      slideIndex += 1;
    }, 5000);
  };
  let timer = createTimer();

  const elementArray = [...hoverItems];
  const toggleHoverIndex = (index: string) => {
    const show = elementArray.filter(
      (el) => el.getAttribute("data-hover-index") === index
    );

    show.forEach((el) => {
      el.toggleAttribute("data-hovered", true);
    });

    const hide = elementArray.filter(
      (el) => el.getAttribute("data-hover-index") !== index
    );
    hide.forEach((el) => {
      el.toggleAttribute("data-hovered", false);
    });
  };

  const hoverListener = (event: any) => {
    const index = event.target.dataset.hoverTarget;
    clearInterval(timer);
    toggleHoverIndex(index);
    slideIndex = Number(index);
    timer = createTimer();
  };

  hoverTargets.forEach((textEl) => {
    textEl.addEventListener("mouseenter", hoverListener);
  });
</script>
